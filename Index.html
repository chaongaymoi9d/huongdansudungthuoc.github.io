<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Tra cứu Thông tin thuốc tiêm truyền</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: auto;
        background-image: url('https://cdn.pixabay.com/photo/2023/10/01/14/40/medicine-8287535_1280.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        color: #fff;
        text-shadow: 1px 1px 2px #000;
    }

    input {
        width: 100%;
        padding: 8px;
        font-size: 16px;
    }

    .suggest {
        border: 1px solid #ccc;
        max-height: 200px;
        overflow: auto;
        margin-top: -1px;
        position: absolute;
        width: calc(100% - 42px);
        background: #fff;
        color: #000;
    }

    .suggest div {
        padding: 8px;
        cursor: pointer;
    }

    .suggest div:hover {
        background: #f0f0f0;
    }

    .table-wrapper {
        overflow-x: auto;
        margin-top: 20px;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        background: rgba(255, 255, 255, 0.95);
        color: #000;
        font-family: Arial, sans-serif;
        font-size: 16px;
        line-height: 1.6;
    }

    th, td {
        padding: 10px;
        border: 1px solid #ccc;
        vertical-align: top;
    }
</style>

</head>
<body>

  <h1>Tra cứu Thông tin thuốc tiêm truyền</h1>
  <div style="position: relative;">
    <input type="text" id="search" placeholder="Nhập Hoạt chất hoặc Biệt dược..." autocomplete="off">
    <div class="suggest" id="suggestions"></div>
  </div>

  <div class="table-wrapper" id="result"></div>

  <script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/1_NCBZsm9rRoa-yi-XQGuHrSkngK6OaiXb55tEMal6jA/export?format=csv';
    let dataset = [];

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: res => dataset = res.data
    });

    const searchEl = document.getElementById('search');
    const sugEl = document.getElementById('suggestions');
    const resEl = document.getElementById('result');

    searchEl.addEventListener('input', () => {
      const q = searchEl.value.trim().toLowerCase();
      sugEl.innerHTML = '';
      if (!q) return;

      const matches = dataset.filter(item =>
        (item['Hoạt chất'] || '').toLowerCase().includes(q) ||
        (item['Biệt dược'] || '').toLowerCase().includes(q)
      );
      matches.slice(0,10).forEach(item => {
        const label = item['Hoạt chất'] || item['Biệt dược'];
        const div = document.createElement('div');
        div.textContent = label;
        div.onclick = () => {
          searchEl.value = label;
          sugEl.innerHTML = '';
          showDetail(item);
        };
        sugEl.appendChild(div);
      });
    });

    function showDetail(item) {
  const columns = Object.keys(item);
  let html = '<table><tbody>';
  columns.forEach(col => {
    let value = item[col] || '';

    // Nếu là link Google Drive
    if (value.startsWith("https://drive.google.com")) {
      // Nếu là ảnh (đuôi jpg/png...) → nhúng ảnh
      if (/\.(jpg|jpeg|png|gif)/i.test(value)) {
        value = `<img src="${value}" alt="${col}" style="max-width:300px;">`;
      }
      // Nếu là PDF → dùng iframe
      else if (value.includes("/file/") && value.includes("view")) {
        const fileId = value.match(/\/file\/d\/(.*?)\//);
        if (fileId) {
          const embedLink = `https://drive.google.com/file/d/${fileId[1]}/preview`;
          value = `<iframe src="${embedLink}" width="100%" height="300px" style="border:none;"></iframe>`;
        }
      }
      // Nếu không xác định được loại → tạo link
      else {
        value = `<a href="${value}" target="_blank">${value}</a>`;
      }
    }

    html += `<tr><td><b>${col}</b></td><td>${value}</td></tr>`;
  });
  html += '</tbody></table>';
  resEl.innerHTML = html;
}


  </script>

</body>
</html>
